## 1 简介

C++ 每个表达式都有两个独立的属性：**类型（type）** 和 **值类别（value category）**，每个表达式正好属于三个基础值类别之一：**prvalue**、**xvalue** 和 **lvalue**，另外还有两个混合值类别分别为 **gvalue** 和 **rvalue**，将在下文进行介绍。

## 2 lvalue 左值

以下表达式为 lvalue 表达式：
- 变量、函数、模板参数对象（从C++20开始）或成员变量的名称，如 `std::cin`，即使变量的类型是右值引用，由其名称组成的表达式也是左值；
- 函数调用或重载运算符表达式，其返回类型为左值引用，如 `std::getline(std::cin, str)`；
- 赋值和复合赋值表达式，如 `a=b`，`a+=b`；
- 前置自增或自减，如 `++a`；
- 解引用，如 `*p`，
- 下标表达式，如 `a[n]`，其中 `a` 是一个左值队列；
- 对象获取成员，如 `a.m`，其中 m 不是枚举成员且不为静态成员函数，并且 a 为 rvalue 时 m 不为非静态成员变量
- 指针获取成员，如 `p->m`，其中 m 不是枚举成员且不为静态成员函数；
- 对象获取指针成员，如 `a.*mp`，其中 a 是左值且 mp 是指向成员变量的指针;
- 指针获取指针成员，如 `p->*mp`，其中 mp 是指向成员变量的指针；
- 逗号表达式，如 `a, b`，其中 b 是左值；
- 三目运算，如 `a ? b : c`，其中 b 和 c 为 lvalue；
- string 字面值，如 `"Hello, world!"`；
- 转换为左值引用类型的表达式，如 `static_cast<int&>(x)`；
- 函数调用或重载运算符表达式，其返回类型为返回右值引用的函数；
- 转换为返回右值引用的函数类型的表达式，如 `static_cast<void (&&)(int)>(x)`；

属性：
- 包括 glvalue 属性；
- 可以进行取址；
- 可作为赋值和复合赋值运算符的左操作数；
- 左值可被左值引用进行绑定；

## 3 prvalue 纯右值

以下表达式为 prvalue 表达式：
- 字面量（除 string 字面量以外），如 `42`；
- 函数调用或重载运算符表达式，其返回类型为非引用类型，如 `str.substr(1, 2)`；
- 后置自增或自减，如 `a++`；
- 算术表达式，如 `a + b`;
- 逻辑表达式，如 `a && b`；
- 比较表达式，如 `a < b`；
- 取址表达式，如 `&a`；
- 对象获取成员，如 `a.m`，其中 m 为枚举成员或者为非静态成员函数;
- 指针获取成员，如 `p->m`，其中 m 为枚举成员或者为静态成员函数;
- 对象获取指针成员，如 `a.*mp`，其中 mp 为指向成员函数的指针；
- 指针获取指针成员，如 `p->*mp`，其中 mp 是指向成员函数的指针；
- 逗号表达式，如 `a, b`，其中 b 是右值；
- 三目运算，如 `a ? b : c`，其中 b 和 c 为 prvalue；
- 转换为非引用类型的表达式，如 `static_cast<double>(x)`；
- this 指针；
- 枚举变量；
- 非类型模板参数，除非其类型是类或（自C++20以来）左值引用类型；
- lambda 表达式，如 `[](int x){ return x * x; }`；
- require 表达式（C++20）；
- 特化的 concept（C++20）；

属性：
- 包括 rvalue 的属性；
- 没有多态的能力；
- 不是类且不是数组的 prvalue 不能是 cv 限定的，除非它的实现是为了绑定到一个 cv 限定类型的引用上；
- 必须有完整的类型；
- 不能具有抽象类类型或其数组；

## 4 xvalue 将亡值

以下表达式为 xvalue 表达式：
- 函数调用或重载运算符表达式，其返回右值引用对象，如 `std::move(x)`；
- 下标表达式，如 `a[n]`，其中 `a` 是一个右值队列；
- 对象获取成员，如 `a.m`，其中 a 为 rvalue 且 m 为非引用类型的非静态成员变量；
- 对象获取指针成员，如 `a.*mp`，其中 a 是右值且 mp 是指向成员变量的指针;
- 三目运算，如 `a ? b : c`，其中 b 和 c 为 xvalue；
- 转换为右值引用类型的表达式，如 `static_cast<char&&>(x)`；
- 临时对象；

属性：
- 包括 rvalue 的属性；
- 包括 gvalue 的属性；

## 5 gvalue 广义左值

一个 gvalue 表达式要么是 lvalue 表达式，要么是 xvalue 表达式。
属性：
- gvalue 可以通过 左值转换成为右值、数组转换为指针、函数转换成指针的形式，隐式转换成prvalue；
- gvalue 可能是多态的；
- gvalue 可以具有不完整的类型；

## 6 rvalue 右值

一个 gvalue 表达式要么是 prvalue 表达式，要么是 xvalue 表达式。

属性：
- rvalue 表达式不能被取址；
- rvalue 不能为赋值运算符的左操作数；
- rvalue 可以初始化 const lvalue 引用，在这种情况下，右值标识的对象的生存期被延长，直到引用的范围结束；
- rvalue 可初始化 rvalue 引用，在这种情况下，右值标识的对象的生存期被延长，直到引用的范围结束；
- 当用作函数参数时，有两个重载可用，一个使用右值引用，一个使用 const 左值引用，rvalue 将被绑定到右值应用的重载中；

## 参考
https://en.cppreference.com/w/cpp/language/value_category
